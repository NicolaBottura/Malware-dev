# HDD Information Evasion - Proof of Concept (Poc)

This repository contains C++ code for a Proof of Concept (PoC) that explores an intriguing evasive technique discovered during the reverse engineering of malware.
For additional details, visit [this link](https://nicolabottura.github.io/).

## Table of Contents
- [Context](#context)
- [Usage](usage)
- [Disclaimer](#disclaimer)

## Context
The presented evasive technique is a variation of known methods that utilize DeviceIoControl to retrieve specific information from a physical drive (e.g. [Check if HDD Vendor ID has specific value](https://evasions.checkpoint.com/techniques/hardware.html#check-if-hdd-vendor-id-has-specific-value)).
In this case the IOCTL used is `SMART_RCV_DRIVE_DATA`, which returns the ATA-2 identify data and other infromation for the device. I encountered this specific control code for the first time while reversing a malware sample, but the data retrieved where utilized for reconnaissance operations and not for an evasive technique.
Upon inspecting the results, I obeserve that on a VirtualBox VM, the returned values for the Serial and Model numbers contained specific VirtualBox indicators. As a result, I wrote this PoC to demonstrate how to obtain such information. A malware could compare the returned data to `VB` or `VBOX`, similar to other evasive techniques and change its behavior depending on the outcome. Soon I will also try WMWare but I expect a similar result.

<p align="center">
  <img src="https://github.com/NicolaBottura/Malware-dev/assets/32301476/84707764-1b87-4232-97f5-083b5f3bb2c0)" alt="poc-output"/>
</p>

## Usage
Simply clone the repository or copy the code, compile the solution and try it. Note that you need adming privileges to execute DeviceIoControl with this control code.
Now you are ready to "evade" from the VBox's jail :)

<p align="center">
  <img src="https://github.com/NicolaBottura/Malware-dev/assets/32301476/3dd84dac-f36a-4090-8989-8d88dd25dee3)" alt="evading-git" width="300">
</p>

## Disclaimer
This repository is for research purposes only, the use of this code is your responsibility. I take NO responsibility and/or liability for how you choose to use any of the source code available here.
